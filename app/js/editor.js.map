{"version":3,"sources":["editor.js"],"names":["alight","d3","D3NE","console","log","numSocket","Socket","componentNum","Component","builder","node","out1","Output","numControl","Control","el","c","value","getData","upd","putData","parseFloat","editor","eventListener","trigger","addEventListener","e","stopPropagation","addControl","addOutput","worker","inputs","outputs","data","num","componentAdd","inp1","Input","inp2","out","control","setValue","val","addInput","sum","nodes","find","n","id","controls","menu","ContextMenu","Values","Value","Action","alert","Add","container","document","getElementById","components","NodeEditor","nn","newNode","n1","n2","add","position","connect","addNode","engine","Engine","view","zoomAt","resize"],"mappings":"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","file":"editor.js","sourcesContent":["console.log(\"WTF!\")\r\n//var D3NE = require(\"d3-node-editor\");\r\n//var alight = require(\"./includes/alight\")\r\n\r\n//var alight = nRequire(\"alight\");\r\n//var d3 = nRequire(\"d3\");\r\n//var D3NE = nRequire(\"d3-node-editor\");\r\n\r\nimport * as alight from '../../node_modules/alight/alight'\r\nimport * as d3 from '../../node_modules/d3'\r\nimport * as D3NE from '../../node_modules/d3-node-editor/build/d3-node-editor'\r\n\r\nvar numSocket = new D3NE.Socket(\"number\", \"Number value\", \"hint\");\r\n\r\nvar componentNum = new D3NE.Component(\"Number\", {\r\n   builder(node) {\r\n      var out1 = new D3NE.Output(\"Number\", numSocket);\r\n      var numControl = new D3NE.Control('<input type=\"number\">',\r\n         (el, c) => {\r\n            el.value = c.getData('num') || 1;\r\n\r\n            function upd() {\r\n               c.putData(\"num\", parseFloat(el.value));\r\n               editor.eventListener.trigger(\"change\");\r\n            }\r\n\r\n            el.addEventListener(\"input\", upd);\r\n            el.addEventListener(\"mousedown\", function(e){e.stopPropagation()});// prevent node movement when selecting text in the input field\r\n           upd();\r\n         }\r\n      );\r\n\r\n      return node.addControl(numControl).addOutput(out1);\r\n   },\r\n   worker(node, inputs, outputs) {\r\n      outputs[0] = node.data.num;\r\n   }\r\n});\r\n\r\nvar componentAdd = new D3NE.Component(\"Add\", {\r\n   builder(node) {\r\n      var inp1 = new D3NE.Input(\"Number\", numSocket);\r\n      var inp2 = new D3NE.Input(\"Number\", numSocket);\r\n      var out = new D3NE.Output(\"Number\", numSocket);\r\n\r\n      var numControl = new D3NE.Control(\r\n         '<input readonly type=\"number\">',\r\n         (el, control) => {\r\n            control.setValue = val => {\r\n               el.value = val;\r\n            };\r\n         }\r\n      );\r\n\r\n      return node\r\n         .addInput(inp1)\r\n         .addInput(inp2)\r\n         .addControl(numControl)\r\n         .addOutput(out);\r\n   },\r\n   worker(node, inputs, outputs) {\r\n      var sum = inputs[0][0] + inputs[1][0];\r\n      editor.nodes.find(n => n.id == node.id).controls[0].setValue(sum);\r\n      outputs[0] = sum;\r\n   }\r\n});\r\n\r\nvar menu = new D3NE.ContextMenu({\r\n   Values: {\r\n      Value: componentNum,\r\n      Action: function() {\r\n         alert(\"ok\");\r\n      }\r\n   },\r\n   Add: componentAdd\r\n});\r\n\r\nvar container = document.getElementById(\"nodeEditor\");\r\nvar components = [componentNum, componentAdd];\r\nvar editor = new D3NE.NodeEditor(\"demo@0.1.0\", container, components, menu);\r\n\r\nvar nn = componentNum.newNode();\r\nnn.data.num = 2;\r\nvar n1 = componentNum.builder(nn);\r\nvar n2 = componentNum.builder(componentNum.newNode());\r\nvar add = componentAdd.builder(componentAdd.newNode());\r\n\r\nn1.position = [80, 200];\r\nn2.position = [80, 400];\r\nadd.position = [500, 240];\r\n\r\neditor.connect(n1.outputs[0], add.inputs[0]);\r\neditor.connect(n2.outputs[0], add.inputs[1]);\r\n\r\neditor.addNode(n1);\r\neditor.addNode(n2);\r\neditor.addNode(add);\r\n//  editor.selectNode(tnode);\r\n\r\nvar engine = new D3NE.Engine(\"demo@0.1.0\", components);\r\n\r\n/*\r\neditor.eventListener.on(\"change\", async function() {\r\n   await engine.abort();\r\n   await engine.process(editor.toJSON());\r\n});\r\n*/\r\n\r\neditor.view.zoomAt(editor.nodes);\r\neditor.eventListener.trigger(\"change\");\r\neditor.view.resize();\r\n"]}